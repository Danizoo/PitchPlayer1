<!DOCTYPE html>
<html>
<head>
    <title>Pitch and Volume Control</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            background-color: black;
            touch-action: none; /* Prevents default scrolling on touch */
        }

        #circleCanvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }
    </style>
</head>
<body>

<canvas id="circleCanvas"></canvas>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        const context = new AudioContext();
        let oscillator = null;
        let gainNode = null;

        // Set initial values
        const screenWidth = window.innerWidth;
        const screenHeight = window.innerHeight;
        const maxVolume = 1;
        const maxPitch = 2400; // Equivalent to 2 octaves

        const canvas = document.getElementById('circleCanvas');
        canvas.width = screenWidth;
        canvas.height = screenHeight;

        // Calculate pitch and volume based on coordinates
        function calculatePitchAndVolume(event) {
            let x, y;

            if (event.type.startsWith('touch')) {
                const touch = event.touches[0] || event.changedTouches[0];
                x = touch.clientX;
                y = touch.clientY;
            } else {
                x = event.clientX;
                y = event.clientY;
            }

            if (!gainNode || !oscillator) return;

            const volume = ((screenWidth - x) / screenWidth) * maxVolume;
            const pitch = (y / screenHeight) * maxPitch;

            gainNode.gain.value = volume;
            oscillator.frequency.value = 261.63 * Math.pow(2, pitch / 1200); // Base C4

            drawCircle(x, y, volume);
        }

        // Draw a circle on the canvas
        function drawCircle(x, y, volume) {
            const ctx = canvas.getContext('2d');
            const circleSize = volume * 50;
            const circleX = x;
            const circleY = y;

            const red = Math.floor((x / screenWidth) * 255);
            const green = Math.floor((1 - Math.abs(x - screenWidth / 2) / (screenWidth / 2)) * 255);
            const blue = Math.floor((1 - x / screenWidth) * 255);

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.beginPath();
            ctx.arc(circleX, circleY, circleSize, 0, 2 * Math.PI);
            ctx.fillStyle = `rgb(${red}, ${green}, ${blue})`;
            ctx.fill();
        }

        // Start playing sound
        function startSound(event) {
            if (oscillator) return; // Already playing

            oscillator = context.createOscillator();
            gainNode = context.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(context.destination);

            calculatePitchAndVolume(event);

            oscillator.start();
        }

        // Stop playing sound
        function stopSound() {
            if (!oscillator) return;

            oscillator.stop();
            oscillator.disconnect();
            gainNode.disconnect();

            oscillator = null;
            gainNode = null;

            clearCircle();
        }

        // Clear the canvas
        function clearCircle() {
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // Event listeners
        window.addEventListener('mousedown', startSound);
        window.addEventListener('mouseup', stopSound);
        window.addEventListener('mousemove', calculatePitchAndVolume);
        window.addEventListener('mouseleave', stopSound);

        window.addEventListener('touchstart', startSound, { passive: false });
        window.addEventListener('touchmove', calculatePitchAndVolume, { passive: false });
        window.addEventListener('touchend', stopSound);
        window.addEventListener('touchcancel', stopSound);
    });
</script>
</body>
</html>
